/*! cilogi-marker - v0.1.0 - 2012-12-05
* https://github.com/cilogi/cilogi-marker/
* Copyright (c) 2012 Tim Niblett; Licensed MIT */
var cilogi=cilogi||{};cilogi.L=cilogi.L||{},cilogi.fn=cilogi.fn||{},function(){typeof cilogi.log=="undefined"&&(cilogi.log=function(){typeof console!="undefined"&&console.log(Array.prototype.slice.call(arguments,0))})}(),function(e){e.lineAdjust={iconic:{"":1.67},awesome:{}}}(cilogi.L),function(e){function n(e,t){function n(e){return parseInt(e*(100+t)/100)}function r(e){var t=e.toString(16);return t.length==1?"0"+t:t}function i(e){return e<255?e:255}var s=i(n(parseInt(e.substring(1,3),16))),o=i(n(parseInt(e.substring(3,5),16))),u=i(n(parseInt(e.substring(5,7),16)));return"#"+r(s)+r(o)+r(u)}function r(e,t){var r=n(t,-40),i="background: "+t+";"+"background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from("+t+"), to("+r+"));"+"background-image: -moz-linear-gradient(top, "+t+", "+r+");"+"background-image: -o-linear-gradient("+t+", "+r+");"+"background-image: -ms-linear-gradient("+t+", "+r+");"+"background-image: linear-gradient(to bottom, "+t+", "+r+");"+"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='"+t+"', endColorstr='"+r+"');";e.style.cssText=i}function i(e){switch(e){case"iconic":return"";case"awesome":return"";default:return e+" NOT FOUND"}}function s(e,t,n){var r=cilogi.L.lineAdjust[t][n];r&&(e.style.lineHeight=r)}function o(e,t,n,r,s){var o=document.createElement("div");this._setIconStyles(o,"icon"),o.style.position="absolute";var u=-e.x+"em",a=-e.y+"em",f=r==i(n)?3:1;return o.style.left=u,o.style.top=a,o.style.margin="0",o.style.fontSize=Math.round(t*f*100)+"%",o.style.color=s,o.className=n,o.innerHTML="<span>"+r+"</span>",this._div=o,o}var t=.6;e.BubbleIcon=L.Icon.extend({options:{fontIconFont:"iconic",fontIconColor:"blue",altThresh:.5,fontIconSize:1,computeClass:function(){return"bubble "+this.fontIconFont+" white"},anchor:new L.Point(1,2.5)},initialize:function(){L.Icon.prototype.initialize.apply(this,arguments),this.options.fontIconName=this.options.fontIconName||i(this.options.fontIconFont),this.options.altIconName=this.options.altIconName||i(this.options.fontIconFont)},computeAnchor:function(e){return this.isAlt(e)?new L.Point(.25,1):new L.Point(1,2.5)},isAlt:function(e){return e<=this.options.altThresh||this.options.fontIconName==this.options.altIconName},createIcon:function(){if(this.isAlt(this.options.fontIconSize)){this._alt=!0;var e=this.computeAnchor(this.options.fontIconSize);return o.call(this,e,this.options.fontIconSize,this.options.fontIconFont,this.options.altIconName,this.options.fontIconColor)}return this._alt=!1,this.createBubbleIcon()},createBubbleIcon:function(){var e=this.computeAnchor(this.options.size),t=document.createElement("div");this._setIconStyles(t,"icon"),t.className="triangle-isosceles",r(t,this.options.fontIconColor);var i=document.createElement("div");i.className="triangle-isosceles-after",t.appendChild(i),i.style.borderTopColor=n(this.options.fontIconColor,-40);var o=document.createElement("div");o.className=this.options.computeClass(),o.innerHTML=this.options.fontIconName,t.appendChild(o);var u=document.createElement("span");return u.className="shine",o.appendChild(u),s(o,this.options.fontIconFont,this.options.fontIconName),t.style.marginLeft=-e.x+"em",t.style.marginTop=-e.y+"em",t.style.fontSize=Math.round(this.options.fontIconSize*100)+"%",this._div=t,t},createShadow:function(){return null},setFontSize:function(e){this.options.fontIconSize=e,this.options.anchor=this.computeAnchor(e)}})}(cilogi.L),function(e,t,n,r){function u(e,t,n,r){function l(e){if(L.Browser.android23)for(var t=0;t<a.length;t++)a[t].style.visibility=e}function c(){L.DomUtil.setOpacity(t,u),f&&(l("hidden"),f=!1),s+=i,u=n+(r-n)*s/e,s>=e&&(clearInterval(o),L.DomUtil.setOpacity(t,r),l("visible"))}var i=25,s=0,o=setInterval(c,i),u=n,a=t.getElementsByTagName("span"),f=!0}function a(e,t){var n=e.getMaxZoom(),r=e.getZoom(),i=n-r;return i<t.length?t[i]:t[t.length-1]}var i=L.Browser.touch?"touchstart":"mousedown",s=L.Browser.touch?"touchend":"mouseup",o=L.Browser.touch?"touchcancel":"mouseout";e.Marker=L.Marker.extend({options:{fontIconSize:1.5,id:-1,sizeTable:[2,1,.5]},initialize:function(e,t){L.Marker.prototype.initialize.call(this,e,t);var r=L.Util.extend({},{fontIconColor:"blue",fontIconName:"",fontIconSize:1.5},t);this.options.icon=new n(r),this.on(i,function(){this._tmpOpacity()},this),this.isReadyPop=!1},_tmpOpacity:function(){u(this.options.fadeTime||1e3,this._icon,.3,1)},setFeatureOptions:function(e){var t=L.Util.extend({},this.options.icon.options,e);this.options.icon=new n(e)},_initIcon:function(){L.Marker.prototype._initIcon.apply(this,arguments),L.DomUtil.addClass(this._icon,"cilogiMarker");if(L.Browser.touch){var e=[s,i,o];for(var t=0;t<e.length;t++)L.DomEvent.removeListener(this._icon,e[t],this._fireMouseEvent,this),L.DomEvent.addListener(this._icon,e[t],this._fireMouseEvent,this)}},selectIfId:function(e){this.select(e===this.options.id)},select:function(e){this.setOpacity(e?1:.2);if(e&&this._map){var t=this._map.getZoom();this._map.setView(this._latlng,t)}},setFontSize:function(e){this._icon&&this._removeIcon(),this.options.icon.setFontSize(e),this._map&&this._map._panes&&(this._initIcon(),this.update())},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e}),e.type!=="mousedown"&&e.type!=="touchstart"&&L.DomEvent.stopPropagation(e)}})}(cilogi.L,cilogi.L.Popup,cilogi.L.BubbleIcon,cilogi.log);
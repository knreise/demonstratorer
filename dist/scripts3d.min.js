!function(e){"use strict";e.parseError=function(e){if(e.responseJSON){if(e.responseJSON.error)return e.responseJSON.error.join(", ");if(e.responseJSON.status)return e.responseJSON.status}return e.statusText?e.statusText:e.error?e.error.info?e.error.info:e.error.error?e.error.error:e.error:"Unknown error"},e.errorHandler=function(t){var r=$(t);r.find(".close").on("click",function(){r.find(".content").html(""),r.remove()});var a=_.template("<div><strong><%= dataset %>:</Strong> <%= error %></div>");return function(t){var i=a({dataset:t.dataset,error:e.parseError(t.error)});r.parent()?r.find(".content").append(i):r.find(".content").html(i),$("body").append(r)}}}(KR=this.KR||{});(KR=this.KR||{}).Config={contentIcons:{IMAGE:"camera-retro",VIDEO:"file-video-o",SOUND:"music",TEXT:"file-text",default:"file-o"},templates:{}},KR.Config.ImageCaheUrl="http://egbtmre.cloudimg.io",KR.Util=KR.Util||{},function(e){"use strict";function t(e,t){var r=e.lastIndexOf(t);return-1!==r&&r+t.length===e.length}e.iconForContentType=function(e){var t=e.properties.contentType;return _.has(KR.Config.contentIcons,t)?KR.Config.contentIcons[t]:KR.Config.contentIcons.default},e.getDatasetTemplate=function(e){var t=$("#"+e+"_template").html();if(t)return _.template(t)},e.templateForDataset=function(e){if(_.has(KR.Config.templates,e))return KR.Config.templates[e]},e.createStyleString=function(e){return _.map(e,function(e,t){return t+": "+e}).join(";")},e.colorForProvider=function(e,t){var r=!0;"hex"!==t&&(r=!1);var a={properties:{datasetId:e}};return KR.Style.colorForFeature(a,r,!0)},e.featureClick=function(e){return function(t,r,a){r.on("click",function(r){a&&a.toPoint&&a.toPoint.stopPolyClick&&!r.parent||(a?e.showFeature(t,a.template,a.getFeatureData):e.showFeature(t))})}},e.getTemplateForFeature=function(e,t){if(t){if(t.datasets){return _.find(t.datasets,function(t){return t._knreise_id===e.properties.datasetID}).template}return t.template}},e.clusterClick=function(t){return function(r,a){r.on("clusterclick",function(r){var i=_.map(r.layer.getAllChildMarkers(),function(t){var r=t.feature;return a&&!r.template&&(r.template=e.getTemplateForFeature(r,a)),r}),n=_.extend({},{template:null,getFeatureData:null,noListThreshold:null},a);t.showFeatures(i,n.template,n.getFeatureData,n.noListThreshold)})}},e.hexToRgba=function(e,t){t=t||1;var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!r)return 0;return"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+","+t+")"},e.filterByBbox=function(e,t){var r=turf.featurecollection([turf.bboxPolygon(KR.Util.splitBbox(t))]);return turf.within(e,r)},e.getDatasetId=function(e){return"norvegiana"===e.dataset.api?e.dataset.dataset:"wikipedia"===e.dataset.api?"wikipedia":e.id?e.id:KR.Util.stamp(e)},"undefined"!=typeof L&&(L.latLngBounds.fromBBoxArray=function(e){return new L.LatLngBounds(new L.LatLng(e[1],e[0]),new L.LatLng(e[3],e[2]))},L.latLngBounds.fromBBoxString=function(e){return L.latLngBounds.fromBBoxArray(KR.Util.splitBbox(e))},L.rectangle.fromBounds=function(e){return L.rectangle([e.getSouthWest(),e.getNorthEast()])}),e.parseQueryString=function(e){var t=decodeURIComponent(e);if(""!==t)return _.reduce(t.replace("?","").split("&"),function(e,t){var r=(t=t.split("="))[1];return"true"===r?r=!0:"false"===r&&(r=!1),e[t[0]]=r,e},{})};var r=_.template("<%= totalt %> (<%= menn %> menn, <%= kvinner %> kvinner)");e.formatPersons=function(e){var t=e.split("-");return t.length<2?e:r({totalt:t[0],menn:t[1],kvinner:t[2]})},e.getBaseLayer=function(e,t){var r={nib:KR.getNibLayer,hist:function(e){e(L.tileLayer.wms("http://wms.geonorge.no/skwms1/wms.historiskekart",{layers:"historiskekart",format:"image/png",attribution:"Kartverket"}))}};if(_.has(r,e))r[e](t);else{var a=!(navigator.userAgent.indexOf("Safari")>-1);t(L.tileLayer.kartverket(e,{useCache:a}))}},e.getLine=function(e,r,a){if(_.isFunction(r))r(function(e){a(e)});else{var i;if(0===r.indexOf("utno/")){i={api:"utno",id:r.replace("utno/",""),type:"gpx"}}else 0===r.indexOf("http")&&(t(r,"kml")?i={api:"kml",url:r}:t(r,"gpx")||-1!==r.indexOf("http://ut.no/tur/")?i={api:"gpx",url:r}:t(r,"geojson")&&(i={api:"geojson",url:r}));i?e.getData(i,function(e){a(e)}):alert("Kunne ikke laste linjegeometri")}},e.messageDisplayer=function(e){return function(t,r){var a=$(e);a.find(".close").on("click",function(){a.find(".content").html(""),a.remove()}),a.addClass("alert-"+t),a.find(".content").html(r),$("body").append(a)}},e.mostlyCoveringMunicipality=function(e,t,r){var a="ST_MakeEnvelope("+t+", 4326)",i={api:"cartodb",query:"SELECT komm FROM kommuner WHERE ST_Intersects(the_geom, "+a+")ORDER BY st_area(st_intersection(the_geom, "+a+")) DESC LIMIT 1",mapper:function(e){return e.rows[0].komm}};e.getData(i,r)},e.sparqlBbox=function(e,t,r,a,i){KR.Util.mostlyCoveringMunicipality(e,r,function(r){t.kommune=function(e){return e<1e3?"0"+e:e}(r),e.getData(t,a,i)})},e.distanceAndSort=function(e,t){var r=_.map(e.features,function(e){return e.properties.distance=turf.distance(t,e),e});return turf.featurecollection(r.sort(function(e,t){return e.properties.distance<t.properties.distance?-1:e.properties.distance>t.properties.distance?1:0}))},e.round=function(e,t){_.isUndefined(t)&&(t=2);var r=Math.pow(10,t);return Math.round(e*r)/r};var a=_.template("#<%= zoom %>/<%= lat %>/<%= lon %>");e.getPositionHash=function(t,r,i){return a({zoom:i,lat:e.round(t,4),lon:e.round(r,4)})},e.WORLD={type:"Feature",geometry:{type:"Polygon",coordinates:[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]]}},e.createMap=function(t,r){r=r||{};var a=L.map(t,{minZoom:r.minZoom||3,maxZoom:r.maxZoom||18,maxBounds:L.geoJson(e.WORLD).getBounds()}),i=r.layer||"norges_grunnkart_graatone";return _.isString(i)?KR.Util.getBaseLayer(i,function(e){e.addTo(a)}):i.addTo(a),r.showScaleBar&&L.control.scale({imperial:!1}).addTo(a),a},e.setupSidebar=function(e,t){t=t||{};var r=KR.Util.getDatasetTemplate("popup"),a=_.template($("#list_item_template").html()),i=_.template($("#marker_template").html()),n=_.template($("#thumbnail_template").html()),o=_.template($("#footer_template").html()),s=_.extend({},{position:"left",template:r,listElementTemplate:a,markerTemplate:i,thumbnailTemplate:n,footerTemplate:o},t),l=L.Knreise.Control.sidebar("sidebar",s);return e.addControl(l),l},e.distanceAndBearing=function(e,t){return{distance:1e3*turf.distance(e,t,"kilometers"),bearing:turf.bearing(e,t)}};var i=_.template("<%= service %>/s/crop/<%= width %>x<%= height %>/<%= image %>");e.getImageCache=function(e,t,r){return KR.Config.ImageCaheUrl?i({service:KR.Config.ImageCaheUrl,width:t,height:r,image:e}):e},e.isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},e.checkThresholdPassed=function(e,t,r){var a;e.on("zoomstart",function(t){a=e.getZoom()}),e.on("zoomend",function(i){var n=e.getZoom();a>t&&n<=t&&r("up"),a<=t&&n>t&&r("down")})}}(KR.Util);(KR=this.KR||{}).Style={},function(e){"use strict";function t(e){var t=e.properties.vernef_id;return _.find(d,function(e){return-1!==e.ids.indexOf(t)})}function r(e){return f[e]||"blue"}function a(e,t,r,a){return _.isFunction(e[t])?a?e[t]():e[t](r):e[t]}function i(e,t,r){return r?a(e,"fillcolor",t,!0):a(e,"fillcolor",t)}function n(e,t){return e.bordercolor?a(e,"bordercolor",t):i(e,t)}function o(t){return e.groups[t]}function s(t){var r;return t.properties&&t.properties.groupId?o(t.properties.groupId):(t.properties&&t.properties.datasetId&&(r=e.getDatasetStyle(t.properties.datasetId)),r||_.extend({},p))}function l(e,t,r){return r=r||9,{radius:r,weight:1,opacity:1,color:e,fillColor:t,fillOpacity:.4}}function u(e,t,r){var a="";return e.properties&&e.properties.title&&(a=e.properties.title),L.marker(t,{icon:r,title:a})}function c(e,t,r){if(e.properties&&e.properties.thumbnail){var a={"border-color":t,"background-image":"url('"+e.properties.thumbnail+"')"};r&&(a["border-width"]="3px");var i='<div class="outer"><div class="circle" style="background-image: url(\''+KR.Util.getImageCache(e.properties.thumbnail,50,50)+"');border-color:"+t+';"></div></div>';return new L.DivIcon({className:"leaflet-marker-circle",html:i,iconSize:[50,50],iconAnchor:[25,25]})}}var d={landskapsvern:{ids:["LVO","LVOD","LVOP","LVOPD","BV","MAV","P","GVS","MIV","NM","BVV","PO","DO","D"],style:{fillColor:"#d8cb7a",color:"#9c8f1b"}},nasjonalpark:{ids:["NP","NPS"],style:{fillColor:"#7f9aac",color:"#b3a721"}},naturreservat:{ids:["NR","NRS"],style:{fillColor:"#ef9874",color:"#ef9873"}}},p={fillcolor:"#38A9DC",circle:!1,thumbnail:!0},m={difo:"Digitalt fortalt",Kulturminnesok:"Kulturminnesok",DiMu:"DigitaltMuseum",MUSIT:"Musit",Artsdatabanken:"Artsdatabanken",wikipedia:"wikipedia",riksantikvaren:"riksantikvaren"};e.datasets={"Digitalt fortalt":{fillcolor:"#F69730",circle:!1,thumbnail:!0},Kulturminnesok:{fillcolor:"#436978",circle:!1,thumbnail:!1},DigitaltMuseum:{fillcolor:"#436978",circle:!1,thumbnail:!1},Musit:{fillcolor:"#436978",circle:!1,thumbnail:!1},Artsdatabanken:{fillcolor:"#5B396B",thumbnail:!1,circle:!0},riksantikvaren:{fillcolor:"#436978",circle:!1,thumbnail:!0},verneomraader:{fillcolor:function(e){if(e){var r=t(e);if(r)return r.style.fillColor}return"#009300"},bordercolor:function(e){if(e){var r=t(e);if(r)return r.style.color}return"#009300"},thumbnail:!1,circle:!0},wikipedia:{fillcolor:"#D14020",thumbnail:!0}},e.groups={},e.getDatasetStyle=function(t){var r=e.datasets[m[t]];return r||(r=e.datasets[t]),r},e.setDatasetStyle=function(t,r){_.has(m,t)||(m[t]=t);var a=e.getDatasetStyle(t);a||(a=p),e.datasets[m[t]]=_.extend({},a,r)};var f={"#F69730":"orange","#38A9DC":"blue","#A23336":"darkred","#72B026":"green","#436978":"cadetblue","#5B396B":"darkpurple","#728224":"darkgreen","#D252B9":"purple","#D14020":"red"};e.getClusterIcon=function(e,t){var r,a=e.getAllChildMarkers(),n=_.uniq(_.map(a,function(e){return e.feature.properties.groupId})),l=s(a[0].feature);if(_.compact(n).length>1){var u=_.compact(n);u.length>1&&(r=_.map(u,_.compose(i,o)))}else r=i(l,a[0].feature);if(t&&(r="#72B026"),l.thumbnail){var c=function(e,t,r){var a=_.filter(e,function(e){return e.feature.properties.thumbnail});if(a.length){var i;_.isArray(t)&&(i=_.rest(t),t=t[0]);var n={"border-color":t,"background-image":"url('"+KR.Util.getImageCache(a[0].feature.properties.thumbnail,50,50)+"');"};i&&(n["box-shadow"]=_.map(i,function(e,t){return"0 0 0 "+2*(t+1)+"px "+e}).join(",")+";"),r&&(n["border-width"]="3px");var o='<div class="outer"><div class="circle" style="'+KR.Util.createStyleString(n)+'"></div></div><b>'+e.length+"</b>";return new L.DivIcon({className:"leaflet-marker-photo",html:o,iconSize:[60,60],iconAnchor:[30,30]})}}(a,r,t);if(c)return c}return function(e,t){var r=KR.Util.hexToRgba(t,.4);return new L.DivIcon({className:"leaflet-marker-circle",html:'<div class="outer"><div class="circle" style="background-color: '+r+";border-color:"+t+';"></div></div><b>'+e.length+"</b>",iconSize:[20,20],iconAnchor:[10,10]})}(a,r)},e.getIcon=function(e,t){var r=s(e),a=t?"#72B026":i(r,e),o=t?"#72B026":n(r,e);if(r.thumbnail){var u=c(e,o,t);if(u)return u}return r.circle?l(o,a,r.radius):function(e){return L.Knreise.icon({markerColor:e})}(a)},e.getMarker=function(t,r){var a=s(t);if(a.thumbnail){var o=c(t,n(a,t),!1);if(o)return u(t,r,o)}return a.circle?function(e,t,r){return L.circleMarker(e,l(t,r))}(r,n(a,t),i(a,t)):u(t,r,e.getIcon(t,!1))},e.colorForFeature=function(e,t,a){var n=s(e);if(n)return t?i(n,e,a):r(i(n,e))},e.colorForDataset=function(t,a,n){var o,l;if(t.grouped?(o=e.groups[KR.Util.stamp(t)])||(l=t.datasets[0].extras.datasetId):(l||(l=t.extras.datasetId),o=s({properties:{datasetId:l}})),o)return a?i(o,null,n):r(i(o,null))},e.getPathStyle=function(e,t){t=t||!1;var r=s(e),a=i(r,e);return{weight:1,color:n(r,e),fillColor:a,clickable:t,opacity:.8,fillOpacity:.4}},e.getPathStyleForGroup=function(t,r){var a={properties:{groupId:t}};return e.getPathStyle(a,r)}}(KR.Style);(KR=this.KR||{}).PathTracer=function(e,t,r){"use strict";var a=1.4,i=35,n=!1,o=0;return function(){var s=r.features[0],l=1e3*turf.lineDistance(s,"kilometers")/a,u=Cesium.JulianDate.fromDate(new Date(2015,2,25,16)),c=Cesium.JulianDate.addSeconds(u,l,new Cesium.JulianDate);!function(t,r){Cesium.Math.setRandomNumberSeed(3),e.clock.startTime=t.clone(),e.clock.stopTime=r.clone(),e.clock.currentTime=t.clone(),e.clock.clockRange=Cesium.ClockRange.LOOP_STOP,e.clock.multiplier=i,e.clock.shouldAnimate=!1}(u,c);var d=function(t,r,a){return e.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:t,stop:r})]),position:a,orientation:new Cesium.VelocityOrientationProperty(a)})}(u,c,function(e,t,r){t=t.reverse(),r.geometry.coordinates=r.geometry.coordinates.reverse();var i=0,n=turf.point(r.geometry.coordinates[0]),o=new Cesium.SampledPositionProperty;return _.each(t,function(t,s){var l=turf.point(r.geometry.coordinates[s]);i+=1e3*turf.distance(n,l,"kilometers"),n=l;var u=Cesium.JulianDate.addSeconds(e,i/a,new Cesium.JulianDate),c=new Cesium.Cartesian3(t.x,t.y,t.z+2);o.addSample(u,c)}),o}(u,t,s));d.position.setInterpolationOptions({interpolationDegree:5,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation}),e.trackedEntity=void 0,function(t){e.clock.onTick.addEventListener(function(r){if(n){var a=Cesium.Cartesian3,i=t.position.getValue(r.currentTime,new a),s=t.position.getValue(Cesium.JulianDate.addSeconds(r.currentTime,1/60,new Cesium.JulianDate),new a),l=a.subtract(s,i,new a);a.normalize(l,l);var u=new a,c=new a,d=new a;Cesium.Ellipsoid.WGS84.geodeticSurfaceNormal(i,u),a.cross({x:0,y:0,z:1},u,c),a.cross(u,c,d);var p=new a;p.x=a.dot(l,c),p.y=a.dot(l,d),p.z=a.dot(l,u);var m=new a(0,0,1),f=new a(1,0,0),g=new a(0,1,0),v=a.dot(p,f),h=a.dot(p,g),k=a.dot(p,m),y=Math.atan2(v,h),b=Math.asin(k);y+=0*Math.PI,b+=-20/180*Math.PI;var _=new Cesium.HeadingPitchRange(y,b+o,800);e.scene.camera.lookAt(t.position.getValue(r.currentTime),_)}})}(d)}(),{start:function(){n=!0,e.clock.shouldAnimate=!0},stop:function(){n=!1,e.clock.shouldAnimate=!1},isRunning:function(){return n},setPitchCorr:function(e){o=e}}};(KR=this.KR||{}).CesiumMap=function(e,t,r){"use strict";function a(e,t,r){var a={SERVICE:"WMTS",REQUEST:"GetTile",TILEROW:"{TileRow}",TILECOL:"{TileCol}",STYLE:"{Style}",LAYER:t};return{url:e+"?"+function(e){return _.map(e,function(e,t){return t+"="+e}).join("&")}(_.extend({},a,r||{})),layer:"",tileMatrixSetID:""}}function i(e){return _.map(e,function(e){var t={position:Cesium.Cartesian3.fromDegrees(e.pos.lng,e.pos.lat,e.pos.height||80),billboard:{image:e.icon,show:!0,heightReference:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,scale:1},label:{text:e.text,font:"14pt monospace",style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,32)},properties:e.properties};return o.entities.add(t),t})}function n(e,t,r,a){r=r||14;var i=[];a||(a=0),_.each(e.features,function(e){var t=e.geometry.coordinates;i.push(new Cesium.Cartographic.fromDegrees(t[0],t[1]))});var n=Cesium.sampleTerrain(o.terrainProvider,r,i);Cesium.when(n,function(r){var i=r;_.each(e.features,function(e,t){var r=i[t];e.geometry.coordinates=[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),r.height+a]}),t(e)})}Cesium.BingMapsApi.defaultKey="";var o,s={cesiumViewerOpts:_.extend({timeline:!1,baseLayerPicker:!1,geocoder:!1,enableLighting:!0,infoBox:!1,animation:!1,orderIndependentTranslucency:!1},t||{})};return function(){var t=(o=new Cesium.Viewer(e,s.cesiumViewerOpts)).scene;t.imageryLayers.removeAll();var a=t.globe;s.cesiumViewerOpts.enableLighting&&(a.enableLighting=!0),a.depthTestAgainstTerrain=!0,o.terrainProvider=function(e){return e=e||"//assets.agi.com/stk-terrain/world",new Cesium.CesiumTerrainProvider({url:e,requestVertexNormals:!0,requestWaterMask:!1})}(s.cesiumViewerOpts.terrainUrl);var i,n=t.camera;if(r){r=KR.Util.splitBbox(r);var l=Cesium.Ellipsoid.WGS84;i=new Cesium.Rectangle(Cesium.Math.toRadians(r[0]),Cesium.Math.toRadians(r[1]),Cesium.Math.toRadians(r[2]),Cesium.Math.toRadians(r[3])),n.viewRectangle(i,l)}i&&s.cesiumViewerOpts.limitBounds&&function(e){var t,r=o.scene.camera;r.moveEnd.addEventListener(function(){var a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(r.position);!Cesium.Rectangle.contains(e,a)&&t&&(r.position=t),t=r.position.clone()})}(i)}(),{viewer:o,addMarkers:i,build3DLine:function(e,t){var r=e.features[0].geometry.coordinates,a=_.map(r,function(e){return new Cesium.Cartographic.fromDegrees(e[0],e[1])}),i=Cesium.sampleTerrain(o.terrainProvider,14,a);Cesium.when(i,function(e){t(Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e))})},addClickhandler:function(e){var t=new Cesium.EntityCollection;new Cesium.ScreenSpaceEventHandler(o.scene.canvas).setInputAction(function(r){var a=o.scene.drillPick(r.position);if(Cesium.defined(a)){t.removeAll();var i=_.map(a,function(e){var r=e.id;return t.add(r),r.properties});i.length&&e(i)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},loadDataset:function(e,t,r,a){r.getBbox(e,t,function(e){n(e,function(e){var t=Cesium.GeoJsonDataSource.load(e);a(t)})},function(e){a()})},loadDataset2:function(e,t,r,a){r.getBbox(e,t,function(e){_.each(e.features,function(e){e.properties=_.extend(e.properties,a)}),n(e,function(e){i(_.map(e.features,function(e){var t=e.properties["marker-color"]||"blue";return{pos:{lat:e.geometry.coordinates[1],lng:e.geometry.coordinates[0],height:e.geometry.coordinates[2]},icon:"../common/img/markers/"+t+".png",properties:e.properties}}))})},function(t){console.warn("could not load dataset",e)})},stopLoading:function(){$(".spinner-wrapper").delay(2e3).fadeOut({duration:200})},getTiles:function(e){return new Cesium.UrlTemplateImageryProvider({url:e})},getWmts:function(e,t,r){return new Cesium.WebMapTileServiceImageryProvider(_.extend({},{style:"default",version:"1.0.0",format:"image/png",maximumLevel:19},a(e,t,r)))},getWms:function(e,t){return new Cesium.WebMapServiceImageryProvider({url:e,layers:t,parameters:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/png",transparent:!0}})},addImageryProvider:function(e){o.imageryLayers.addImageryProvider(e)}}},KR.CesiumUtils={},KR.CesiumUtils.getBounds=function(e){"use strict";var t=turf.envelope(e).geometry.coordinates[0];return t[0].concat(t[2]).join(",")};(KR=this.KR||{}).CesiumSidebar=function(e,t,r,a){"use strict";function i(e){return{properties:e,template:e.template}}a=a||{footerTemplate:_.template($("#footer_template").html()),listElementTemplate:_.template($("#list_item_template").html()),markerTemplate:_.template($("#marker_template").html()),thumbnailTemplate:_.template($("#thumbnail_template").html())};var n=$('<div id="sidebar"></div>');e.append(n);var o=$('<div class="top-menu"></div>');n.append(o);var s=$('<a class="close pull-right">×</a>');o.append(s);var l=$("<span></span>");o.append(l);var u=$('<div class="sidebar-content"></div>');n.append(u);var c=new KR.SidebarContent(n,u,l,a),d=r;return e.addClass("knreise-sidebar"),s.click(function(){e.hide("slide",{direction:"left"},100),function(e){u.html(e)}(""),d&&d()}),{show:function(t){e.show("slide",{direction:"left"},100),1===t.length?function(e){c.showFeature(i(e))}(t[0]):function(e){var t=_.map(e,i);c.showFeatures(t)}(t)},addCloseCb:function(e){d=e}}};var KR=this.KR||{};!function(){"use strict";function e(){function e(){if(r&&t&&t.userPosition&&a){i&&i.remove();var e=r.find("h3").eq(0),o=function(e){if(t&&t.userPosition){var r=turf.point([t.userPosition.lng,t.userPosition.lat]),a=KR.Util.distanceAndBearing(r,e),i=a.distance;return i=i<1e3?KR.Util.round(i,0)+" Meter":KR.Util.round(i/1e3,2)+" Kilometer",{dist:i,rot:a.bearing-45}}}(a);i=$(n({distanceBearing:o})),e.length?e.after(i):r.prepend(i)}}var t,r,a,i,n=_.template($("#user_position_template").html());return{setMap:function(r){(t=r).on("locationChange",e)},selectFeature:function(t,i){r=i,a=t,e()}}}KR.SidebarContent=function(t,r,a,i){function n(e){r.html(e)}function o(e,t,r,a,n,s){var c;t>0&&(c=function(i){i&&i.preventDefault();var u=o(e=n[t-=1],t,r,a,n,s);l(e,r,a,u,t,n.length)});var d;return t<n.length-1&&(d=function(i){i&&i.preventDefault();var u=o(e=n[t+=1],t,r,a,n,s);l(e,r,a,u,t,n.length)}),s||(s=function(){u(n,r,a,i.noListThreshold,!0)}),{prev:c,close:s,next:d}}function s(e){e.find('img[data-fullsize-url!=""]').click(function(){var e=$(this).attr("data-fullsize-url");e&&$("#overlay").removeClass("hidden").html($('<img src="'+e+'" />')).click(function(){$("#overlay").addClass("hidden").html("")})})}function l(e,o,u,d,p,m){var f=o.template;if(u){var g="";return e.properties.title&&(g+="<h3>"+e.properties.title+"</h3>"),g+='<i class="fa fa-spinner fa-pulse fa-3x"></i>',n(g),void u(e,function(t){t.properties=_.extend(e.properties,t.properties),l(t,o,null,d,p,m)})}var v=e.properties.images;_.isArray(v)&&(v=v[0]),e.properties.images||(e.properties.images=null),e.properties.allProps&&e.properties.allProps.europeana_rights?e.properties.license=e.properties.allProps.europeana_rights[0]:e.properties.license=e.properties.license;g='<span class="providertext" style="color:'+o.style.fillcolor+';">'+e.properties.provider+"</span>";if(g+=f(_.extend({image:null},e.properties)),i.footerTemplate&&e.properties.link&&(g+=i.footerTemplate(e.properties)),g=$(["<div>",g,"</div>"].join(" ")),KR.Util.isInIframe()&&g.find("a").attr("target","_blank"),c.selectFeature(e,g),n(g),function(e){e&&r.swipe({swipe:function(){},allowPageScroll:"vertical"}).off("swipeLeft").on("swipeLeft",function(){e.next&&e.next()}).off("swipeRight").on("swipeRight",function(){e.prev&&e.prev()})}(d),t.find(".prev-next-arrows").remove(),a.html(""),d){var h=$('<a class="pull-left list-btn"><i class="fa fa-bars"></i></a>');a.append(h),h.click(d.close);var k=p+1;a.append($('<div class="top-text pull-left"><b>'+k+"</b> av "+m+"</div>"));var y=$('<a class="prev-next-arrows prev circle"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a>');t.append(y),d.prev&&y.click(d.prev).addClass("active");var b=$('<a class="prev-next-arrows next circle"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>');t.append(b),d.next&&b.click(d.next).addClass("active"),t.append($('<div id="overlay" class="hidden"></div>'))}s(t);var R=r.find(".media-container");R.length&&KR.MediaCarousel.SetupMediaCarousel(R,s),"undefined"!=typeof audiojs&&audiojs.createAll(),r.scrollTop(0)}function u(e,t,n,s,u){s=void 0===s?i.noListThreshold:s;if(e.length<=s&&!0!==u){var c=e[0];r.html("");var d=o(c,0,t,n,e);this.showFeature(c,t,n,d,0,e.length)}else{var p=$('<span class="circle">'+e.length+"</span>");a.html(p);var m=_.chain(e).groupBy(function(e){return e.properties.provider}).map(function(r,a){var s=$("<div></div>"),u=$('<div class="list-group"></ul>'),c=_.map(r,function(r){var a=_.findIndex(e,function(e){return e===r});return function(e,t,r,a,n){var s,u=KR.Style.colorForFeature(e,!0);s=e.properties.thumbnail?i.thumbnailTemplate({thumbnail:KR.Util.getImageCache(e.properties.thumbnail,80,60),thumbnail2x:KR.Util.getImageCache(e.properties.thumbnail,120,90),color:u}):i.markerTemplate({icon:"",color:u});var c=$(i.listElementTemplate({title:e.properties.title,marker:s}));return c.on("click",function(i){i.preventDefault();var s=o(e,t,r,a,n);return l(e,r,a,s,t,n.length),!1}),c}(r,a,t,n,e)},this);return u.append(c),s.append('<h5 class="providertext">'+a+"</h5>"),s.append(u),s}).value();r.html(m),r.scrollTop(0)}}var c=new e;return r=$(r),t=$(t),a=$(a),{showFeature:l,showFeatures:u,setMap:function(e){c.setMap(e)}}}}();(KR=this.KR||{}).DatasetLoader=function(e,t,r,a,i,n){"use strict";function o(e,t){var r={dataset:t,onEachFeature:function(e,r){f&&f(e,r,t)}};return t.style&&(r.style=t.style),L.Knreise.geoJson(e,r)}function s(e,t){e.clearLayers();var r=_.reduce(t,function(e,t){return e.concat(t.toGeoJSON().features)},[]);e.addData(KR.Util.createFeatureCollection(r)),e.fire("dataAdded")}function l(e,t){e.enabled!==t&&(e.enabled=t,e.fire("changeEnabled"))}function u(e){if(e.datasets&&!e.grouped){return _.filter(e.datasets,function(e){return e.visible}).length>0}return e.visible}function c(e,r){e.init&&e.init(t,e,r)}function d(r,d,p,f,g){function v(e,t){if(r.minFeatures){if(e.numFound&&r.minFeatures<e.numFound)return l(t,!1),KR.Util.createFeatureCollection([]);l(t,!0)}return e}var h=function(e,t){var r;i?r=o(null,e):e.cluster?(r=new L.Knreise.MarkerClusterGroup({dataset:e,maxClusterRadius:n,unclusterCount:e.unclusterCount}).addTo(t),m&&m(r,e)):r=o(null,e).addTo(t);var a=!0;return e.minFeatures&&(a=!1),r.enabled=a,r}(r,t);r.datasets?(r.datasets=_.filter(r.datasets,function(e){return!e.noLoad}),_.each(r.datasets,function(e){c(e,h)})):c(r,h);var k,y=function(n,l,c,p){var m=!n,f=l||t.getBounds().toBBoxString(),y=c||function(e){return e.minZoom?!(t.getZoom()<e.minZoom)&&u(e):u(e)}(r);if(g&&f){var b=L.latLngBounds.fromBBoxString(f);L.latLngBounds.fromBBoxString(g).intersects(b)||(y=!1)}if(h.enabled=function(e){return!(e.minZoom&&t.getZoom()<e.minZoom)}(r),h.fire("changeEnabled"),h.shouldLoad=y,!y)return h.clearLayers(),void(p&&p([]));var R;R=r.datasets?_.filter(r.datasets,function(e){return e.visible}):[r];var C=[],w=_.after(R.length,function(){i?s(h,C):r.cluster?function(e,r){e.clearLayers();var a=_.reduce(r,function(e,r){return r.setMap&&r.setMap(t),e.concat(r.getLayers())},[]);e.addLayers(a)}(h,C):s(h,C),h.isLoading=!1,h.fire("dataloadend"),p&&p(C)});h.isLoading=!0,h.fire("dataloadstart"),_.each(R,function(t){function r(e){t.geoJson=e,h.error=null,d&&(e=d(e));var r;i?r=L.geoJson(s(v(e,h))):t.cluster?(r=o(s(v(e,h)),t),t.geoJSONLayer=r):r=L.geoJson(s(v(e,h))),C.push(r),w()}function n(e){h.error=e,w(),"abort"!==e.statusText&&(a?a({dataset:t.name,error:e,layer:h}):h.fire("error",e))}var s=function(e){var t=KR.Util.stamp(e);return function(r){return r&&r.features.length?(_.each(r.features,function(r){r.properties.datasetID=t,_.has(e,"circle")&&(r.properties.circle=e.circle),_.has(e,"provider")&&(r.properties.provider=e.provider),_.has(e,"extras")&&(r.properties=_.extend(r.properties,e.extras)),r.properties.feedbackForm=e.feedbackForm,_.has(e,"mappings")&&_.each(e.mappings,function(e,t){r.properties[t]=r.properties[e]}),r.template=KR.Util.getTemplateForFeature(r,e)}),r):r}}(t);if(!m&&t.isStatic||k===f)r(t.geoJson);else if(t.bbox){var l=f;t.isStatic&&t.fixedBbox&&(l=t.fixedBbox),t.bboxFunc?t.bboxFunc(e,t.dataset,l,r,n):e.getBbox(t.dataset,l,r,n)}else e.getData(t.dataset,r,n)}),k=f};return y(null,p,void 0,function(e){!function(e){var r=[];e.datasets?r=e.datasets:r.push(e),_.each(r,function(e){if(e.loadWhenLessThan){var r=function(){if(e.geoJson){var r=turf.bboxPolygon(KR.Util.splitBbox(t.getBounds().toBBoxString())),a=_.filter(e.geoJson.features,function(e){return turf.inside(e,r)});a.length<=e.loadWhenLessThan.count?e.loadWhenLessThan.callback(t,e,a):e.loadWhenLessThan.callback(t,e)}};t.on("moveend",r),r()}})}(r),f&&f(e)}),function(e){return e.datasets?0===_.filter(e.datasets,function(e){return!1===e.isStatic}).length:e.isStatic}(r)&&!r.minZoom||t.on("moveend",y),function(e,t){e.on("hide",function(){t(!0)}),e.on("show",function(){t(!0)})}(h,y),{layer:h,reload:y}}function p(e){var t=KR.Util.getDatasetId(e);e.extras=e.extras||{},e.extras.datasetId=t,e.style&&KR.Style.setDatasetStyle(t,e.style)}n=n||80;var m,f,g=[],v={isStatic:!0,bbox:!0,cluster:!0,visible:!0};return r&&(m=KR.Util.clusterClick(r),f=KR.Util.featureClick(r)),{loadDatasets:function(e,r,a,o,s){e=_.filter(e,function(e){return!e.noLoad});var l;if(o){var u=[],c=_.after(e.length,function(){o(u)});l=function(e){u.push(e),c()}}var f=_.map(e,function(e){return(e=_.extend({},v,e)).datasets&&function(e){var t=_.reduce(_.without(_.keys(e),"datasets"),function(t,r){return"style"!==r&&(t[r]=e[r]),t},{});if(e.style){t.extras=t.extras||{};var r=KR.Util.stamp(e);t.extras.groupId=r,KR.Style.groups[r]=e.style}e.datasets=_.map(e.datasets,function(e){return _.extend({},t,e)})}(e),KR.Style.setDatasetStyle&&(e.datasets?_.each(e.datasets,p):p(e)),e.visible||(e.notLoaded=!0),e.minZoom&&e.bbox&&(e.isStatic=!1),d(e,a,r,l,s)});g=_.pluck(f,"reload");var h=_.pluck(f,"layer");return i&&function(e){var r={},a=function(){_.each(e,function(e){e.deselectAllNew()})};t.on("layerDeselect",a);var i=new L.Knreise.MarkerClusterGroup({maxClusterRadius:n}).addTo(t);i.on("clusterclick",a),m(i),_.each(e,function(t){t.on("dataAdded",function(){var n=L.stamp(t);r[n]&&i.removeLayers(r[n]);var o=t.getLayers();r[n]=o,i.addLayers(o),t.on("hide",function(){r[n]&&i.removeLayers(r[n])}),t.on("click",function(t){a();var r=t.layer;_.find(e,function(e){return!!_.find(e.getLayers(),function(e){return e===r})}).setLayerSelected(r)})})})}(h),h},reload:function(e,t){var r=_.after(g.length,function(){t&&t()});_.each(g,function(t){t(null,null,e,r)})}}};(KR=this.KR||{}).Config=KR.Config||{},function(e){"use strict";KR.Config.getKulturminneFunctions=function(e){var t,r,a,i,n,o,s,l,u=!0,c=function(e){return _.find(a.getLayers(),function(t){return t.feature.properties.id===e})},d=function(e){return _.find(n.getLayers(),function(t){return t.feature.properties.lok===e})},p=function(e){return L.geoJson(null,{onEachFeature:function(t,a){e.extras&&e.extras.groupId?a.setStyle(KR.Style.getPathStyleForGroup(e.extras.groupId)):(t.properties.datasetId=e.id,a.setStyle(KR.Style.getPathStyle(t,!0))),a.on("click",function(){!function(e){var t=c(e.properties.lok);if(t)t.fire("click");else if(i.sidebar){var a=_.find(l,function(t){return t.feature.properties.id===e.properties.lok});f(d(e.properties.lok)),i.sidebar.showFeature(a.feature,r.template,r.getFeatureData)}}(t)})}}).addTo(i)},m=function(){t=null,_.each(n.getLayers(),function(e){e.setStyle(KR.Style.getPathStyle(e.feature,!0))})},f=function(e){e.setStyle({weight:1,color:"#436978",fillColor:"#72B026",clickable:!0,opacity:.8,fillOpacity:.4})},g=function(e){m();var r=e.layer.feature.properties.id;t=r;var a=d(r);a&&(f(a),o&&o(e.layer.feature))},v=function(t){_.has(t,"enkeltminner")||(t.enkeltminner={});var r=t.enkeltminner.style||{color:"#fff",weight:1,fillColor:"#B942D0"};s=L.geoJson(null,{onEachFeature:function(e,r){e.properties.provider=t.enkeltminner.provider||"Enkeltminne",e.properties.color=t.enkeltminner.sidebarColor||"#B942D0",r.on("click",function(){!function(e,t){i.sidebar&&i.sidebar.showFeature(e,t.enkeltminner.template||KR.Util.getDatasetTemplate("ra_enkeltminne"))}(e,t)})},style:function(){return r}}).addTo(i),o=function(t){var r={api:"kulturminnedataSparql",type:"enkeltminner",lokalitet:t.properties.id};e.getData(r,function(e){s.clearLayers(),s.addData(e)})}},h=function(e){n.clearLayers().addData(e),t&&(function(e){var t=d(e);t&&f(t)}(t),function(e){var t=c(e);t&&t.fire("click")}(t))},k=function(t){t.prevLayers&&t.prevLayers.length&&(l=t.prevLayers);var r=a.getUnclustredLayers(),i=_.map(r,function(e){return e.feature.properties.id}),o=[];if(a.isUnclustred&&(o=_.chain(n.getLayers()).map(function(e){return e.feature.properties.lok}).difference(i).value()),(i=i.concat(o)).length){var u={api:"kulturminnedataSparql",type:"lokalitetpoly",lokalitet:i};e.getData(u,h)}else n.clearLayers(),s&&s.clearLayers()};return{initKulturminnePoly:function(e,t,o){r=t,a=o,i=e,n=p(t),a.on("dataloaded",k),a.on("click",g),i.on("layerDeselect",m),_.has(t,"showEnkeltminner")&&(u=t.showEnkeltminner),u&&v(t)},getRaFeatureData:function(t,r){var a={api:"kulturminnedataSparql",type:"images",lokalitet:t.properties.id};e.getData(a,function(e){e=_.map(e,function(e){return{type:"captioned_image",url:e.img,caption:e.picturelabel+" - "+e.picturedescription,license:e.picturelicence,fullsize:e.img_fullsize}}),t.properties.media=e,r(t)})}}}}();(KR=this.KR||{}).Config=KR.Config||{},function(e){"use strict";e.getDatasetList=function(t){var r=e.getKulturminneFunctions(t);return{difo:{name:"Digitalt fortalt",dataset:{dataset:"difo",api:"norvegiana"},cluster:!0,template:KR.Util.getDatasetTemplate("digitalt_fortalt"),noListThreshold:1/0,description:"Kulturrådets tjeneste for personlige fortellinger fra kulturinstitusjoner og privatpersoner.",allowTopic:!0,feedbackForm:!0,isStatic:!1,style:{fillcolor:"#F69730",circle:!1,thumbnail:!0}},verneomr:{id:"verneomraader",dataset:{api:"cartodb",table:"naturvernomrader_utm33_2",columns:["iid","omradenavn","vernef_id","verneform"]},provider:"Naturbase",name:"Verneområder",template:KR.Util.getDatasetTemplate("verneomraader"),getFeatureData:function(e,t){console.log("NO API in datasets.js"),t()},toPoint:{showAlways:!0,stopPolyClick:!0,minSize:20},minZoom:10,cluster:!1,description:"Nasjonalparker og andre naturvernområder - ca. 2700 i hele landet."},artobs:{name:"Artsobservasjoner",hideFromGenerator:!0,dataset:{api:"norvegiana",dataset:"Artsdatabanken"},cluster:!1,description:"Artsobservasjoner fra Artsdatabanken",template:KR.Util.getDatasetTemplate("popup")},folketelling:{name:"Folketelling 1910",provider:"Folketelling 1910",dataset:{api:"folketelling",dataset:"property"},isStatic:!1,minZoom:14,template:KR.Util.getDatasetTemplate("folketelling"),getFeatureData:function(e,t){console.log("NO API in datasets.js"),t()},mappings:{title:"gaardsnavn_gateadr"},noListThreshold:0,description:"Personer og eiendommer fra folketellingen 1910"},ark_hist:{grouped:!0,name:"Arkeologi og historie",minZoom:14,datasets:[{name:"MUSIT",provider:"Universitetsmuseene",dataset:{api:"norvegiana",dataset:"MUSIT"},template:KR.Util.getDatasetTemplate("musit")},{name:"DiMu",dataset:{api:"norvegiana",dataset:"DiMu"},template:KR.Util.getDatasetTemplate("digitalt_museum"),isStatic:!1},{id:"riksantikvaren",name:"Riksantikvaren",provider:"Riksantikvaren",dataset:{api:"kulturminnedataSparql",kommune:null,fylke:null},getFeatureData:r.getRaFeatureData,template:KR.Util.getDatasetTemplate("ra_sparql"),bbox:!1,isStatic:!1,unclusterCount:20,init:r.initKulturminnePoly}],description:"Data fra Universitetsmuseene, Digitalt museum og Riksantikvaren"},jernbane:{id:"jernbane",dataset:{api:"jernbanemuseet"},provider:"Jernbanemuseet",name:"Jernbanemuseet",hideFromGenerator:!0,template:KR.Util.getDatasetTemplate("jernbanemuseet"),getFeatureData:function(e,t){console.log("NO API in datasets.js"),t()},isStatic:!0,bbox:!1,description:"Jernbanemuseet"},arkeologi:{grouped:!0,name:"Arkeologi",minZoom:14,style:{fillcolor:"#436978",circle:!1,thumbnail:!0},datasets:[{name:"MUSIT",provider:"Universitetsmuseene",dataset:{api:"norvegiana",dataset:"MUSIT"},template:KR.Util.getDatasetTemplate("musit")}],description:"Arkeologidata fra Universitetsmuseene og Riksantikvaren"},historie:{grouped:!0,name:"Historie",minZoom:14,style:{fillcolor:"#D252B9",circle:!1,thumbnail:!0},datasets:[{name:"DiMu",dataset:{api:"norvegiana",dataset:"DiMu",query:"-dc_subject_facet:Kunst"},template:KR.Util.getDatasetTemplate("digitalt_museum"),isStatic:!1,bbox:!0,style:{fillcolor:"#436978",circle:!1,thumbnail:!1}},{dataset:{api:"norvegiana",dataset:"Industrimuseum"},isStatic:!1,bbox:!0},{dataset:{api:"norvegiana",dataset:"Foto-SF"},isStatic:!1,bbox:!1,template:KR.Util.getDatasetTemplate("foto_sf")},{dataset:{api:"norvegiana",dataset:"Kystreise"},isStatic:!0,bbox:!1}],description:"Historie og kulturminner fra Riksantikvaren og Digitalt museum "},kunst:{grouped:!0,name:"Kunst",style:{fillcolor:"#72B026",circle:!1,thumbnail:!0},datasets:[{name:"DiMu",dataset:{api:"norvegiana",dataset:"DiMu",query:"dc_subject_facet:Kunst"},template:KR.Util.getDatasetTemplate("digitalt_museum"),isStatic:!1,style:{fillcolor:"#436978",circle:!1,thumbnail:!1}}],description:"Kunstdata fra Digitalt museum "},wikipedia:{name:"Wikipedia",provider:"Wikipedia",dataset:{api:"wikipedia"},style:{thumbnail:!0},minZoom:13,template:KR.Util.getDatasetTemplate("wikipedia"),description:"Stedfestede artikler fra bokmålswikipedia",style:{fillcolor:"#D14020",thumbnail:!0}},wikipediaNN:{name:"Wikipedia Nynorsk",provider:"Wikipedia Nynorsk",dataset:{api:"wikipediaNN"},style:{thumbnail:!0},minZoom:13,template:KR.Util.getDatasetTemplate("wikipedia"),description:"Stedfestede artikler fra nynorskwikipedia",style:{fillcolor:"#D14020",thumbnail:!0}},lokalwiki:{id:"lokalwiki",name:"Lokalhistoriewiki",hideFromGenerator:!1,provider:"Lokalhistoriewiki",dataset:{api:"lokalhistoriewiki"},style:{thumbnail:!0},minZoom:13,bbox:!0,isStatic:!1,description:"Stedfestede artikler fra lokalhistoriewiki.no"},riksantikvaren:{id:"riksantikvaren",name:"Kulturminnesøk",hideFromGenerator:!1,provider:"Riksantikvaren",dataset:{api:"kulturminnedataSparql",kommune:null,fylke:null},getFeatureData:r.getRaFeatureData,template:KR.Util.getDatasetTemplate("ra_sparql"),bbox:!1,isStatic:!1,description:"Data fra Riksantikvarens kulturminnesøk",unclusterCount:20,init:r.initKulturminnePoly},brukerminner:{name:"Kulturminnesøk - brukerregistreringer",hideFromGenerator:!1,provider:"riksantikvaren",dataset:{api:"kulturminnedata",layer:2,getExtraData:!0,extraDataLayer:6,matchId:"KulturminnesokID"},cluster:!0,isStatic:!1,style:{thumbnail:!0},description:"Brukerregistrerte data fra Riksantikvarens kulturminnesøk",template:KR.Util.getDatasetTemplate("brukerminne"),style:{fillcolor:"#436978",circle:!1,thumbnail:!1}},groruddalen:{name:"Byantikvaren Oslo - Groruddalen",hideFromGenerator:!0,provider:"Byantikvaren i Oslo",dataset:{api:"cartodb",table:"byantikvaren_oslo_groruddalen"},bbox:!1,isStatic:!1,style:{thumbnail:!0},template:KR.Util.getDatasetTemplate("byantikvaren_oslo"),description:"Byantikvarens Groruddalsatlas"},norgerundt:{name:"Norge Rundt",hideFromGenerator:!0,provider:"NRK",dataset:{api:"cartodb",table:"nrk_norge_rundt"},bbox:!1,isStatic:!1,style:{thumbnail:!0},description:"Stedfestede innslag fra Norge Rundt"},dimu:{name:"Digitalt Museum",hideFromGenerator:!1,provider:"dimu",dataset:{dataset:"DiMu",api:"norvegiana"},cluster:!0,isStatic:!1,style:{thumbnail:!0},description:"Alle stedfestede data fra Digitalt Museum",allowTopic:!0,feedbackForm:!0},musit:{name:"Universitetsmuseene",hideFromGenerator:!1,provider:"Universitetsmuseene",dataset:{dataset:"MUSIT",api:"norvegiana"},cluster:!0,isStatic:!1,style:{thumbnail:!0},description:"Alle stedfestede data fra Universitetsmuseene",allowTopic:!0,feedbackForm:!0},industrimuseum:{name:"Industrimuseum",hideFromGenerator:!1,provider:"Industrimuseum",dataset:{dataset:"Industrimuseum",api:"norvegiana"},cluster:!0,isStatic:!1,style:{thumbnail:!0},description:"Alle stedfestede data fra Industrimuseum",allowTopic:!0,feedbackForm:!0},kystreise:{name:"Kystreise",hideFromGenerator:!1,provider:"Kystreise",dataset:{dataset:"Kystreise",api:"norvegiana"},cluster:!0,isStatic:!1,style:{thumbnail:!0},description:"Alle stedfestede data fra Kystreise",allowTopic:!0,feedbackForm:!0},dimufoto:{hideFromGenerator:!0,dataset:{api:"norvegiana",dataset:"DiMu",query:"europeana_type_facet:IMAGE"},template:KR.Util.getDatasetTemplate("digitalt_museum"),isStatic:!1,style:{thumbnail:!0},noListThreshold:1/0},kulturminnesok_flickr:{name:"Kulturminnesøk",dataset_name_override:"Kulturminnesøk",provider:"Kulturminnesøk Flickr",hideFromGenerator:!0,dataset:{api:"flickr",group_id:"1426230@N24"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!0,style:{thumbnail:!0},description:"Bilder fra Kulturminnesøks Flickr-gruppe"},riksarkivet:{name:"Riksarkivet",dataset_name_override:"Riksarkivet",provider:"riksarkivet",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"national_archives_of_norway"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Riksarkivets Flickr-konto"},nasjonalbiblioteket:{name:"Nasjonalbiblioteket",dataset_name_override:"Nasjonalbiblioteket",provider:"nasjonalbiblioteket",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"national_library_of_norway"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Nasjonalbibliotekets Flickr-konto"},oslobyarkiv:{name:"Oslo Byarkiv",dataset_name_override:"Oslo Byarkiv",provider:"oslobyarkiv",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"byarkiv"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Oslo byarkiv sin Flickr-konto"},nasjonalmuseet:{name:"Nasjonalmuseet",dataset_name_override:"Nasjonalmuseet",provider:"nasjonalmuseet",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"nasjonalmuseet"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Nasjonalmuseet sin Flickr-konto"},nve:{name:"NVE",dataset_name_override:"NVE",provider:"nve",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"nve",accuracy:"6"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra NVE Flickr-konto"},vestfoldmuseene:{name:"Vestfoldmuseene",dataset_name_override:"Vestfoldmuseene",provider:"Vestfoldmuseene",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"vestfoldmuseene",accuracy:"1"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Vestfoldmuseene sin Flickr-konto"},perspektivet:{name:"Perspektivet Museum",dataset_name_override:"Perspektivet Museum",provider:"Perspektivet Museum",hideFromGenerator:!0,dataset:{api:"flickr",user_id:"perspektivetmuseum",accuracy:"1"},template:KR.Util.getDatasetTemplate("flickr"),isStatic:!1,style:{thumbnail:!0},description:"Bilder fra Perspektivet Museum sin Flickr-konto"}}},e.getDatasets=function(t){var r=e.getDatasetList();return _.chain(t).map(function(e){var t;if(e.indexOf(":")>-1){var a=e.split(":");e=a[0],t=a[1]}if(_.has(r,e)){var i=r[e];return t&&"norvegiana"===i.dataset.api&&(i.dataset.query="dc_subject_text:"+t),i}}).compact().value()}}(KR.Config);KR=this.KR||{};!function(e){"use strict";function t(e,t,r){var a=e.layer||"topo2";if("norges_grunnkart_graatone"===a&&(a="norges_grunnkart"),"hist"===a)r(t.getWms("http://wms.geonorge.no/skwms1/wms.historiskekart","historiskekart"));else if("nib"===a){KR.Util.sendRequest("http://knreise.no/nib/?type=token",null,function(e){r(0!==e.indexOf("**")?t.getWmts("http://www.knreise.no/miniProxy/miniProxy.php/http://gatekeeper1.geonorge.no/BaatGatekeeper/gk/gk.nibcache_wmts","NiB",{TILEMATRIXSET:"EPSG:900913",TILEMATRIX:"EPSG:900913:{TileMatrix}",FORMAT:"image/jpeg",GKT:e}):t.getTiles("http://www.webatlas.no/wacloud/servicerepository/combine.aspx?X={x}&Y={y}&Z={z}&layers=TMS_WEBATLAS_STANDARD:1"))})}else r(t.getWmts("http://opencache.statkart.no/gatekeeper/gk/gk.open_wmts",a,{TILEMATRIXSET:"EPSG:3857",TILEMATRIX:"EPSG:3857:{TileMatrix}",FORMAT:"image/png"}))}var r={animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,orderIndependentTranslucency:!1};KR.setupMap3d=function(e,a,i){function n(){var t=KR.Config.getDatasets(a,e);return _.chain(t).map(function(e){return e.datasets?e.datasets:e}).flatten().filter(function(e){return!_.has(e.dataset,"kommune")||!_.isUndefined(e.dataset.kommune)}).value()}function o(e,t){return new KR.CesiumMap(e,_.extend(r,{limitBounds:i.limitBounds,terrainUrl:i.terrainUrl,enableLighting:i.enableLighting}),t)}function s(t,r,a){_.each(t,function(t){var a=KR.Util.getDatasetId(t),i={template:t.template,datasetId:a,"marker-color":KR.Style.colorForFeature({properties:{datasetId:a}},!1)};c.loadDataset2(t.dataset,r,e,i)}),c.addClickhandler(function(e){p.show(e),a&&a()})}function l(e){(c=o("cesium-viewer",e)).viewer.scene.imageryLayers.removeAll(),t(i,c,c.addImageryProvider),s(n(),e),c.stopLoading()}function u(){var r,a,l=!1;KR.Util.getLine(e,i.line,function(e){if(d=KR.CesiumUtils.getBounds(e),c=o("cesium-viewer",d),t(i,c,c.addImageryProvider),s(n(),d,function(){i.player&&(l=r.isRunning(),a.pause(),r.stop())}),c.build3DLine(e,function(e){var t=function(e,t){return t=t||{},{polyline:{positions:e,width:5,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.ORANGE,outlineWidth:2,outlineColor:Cesium.Color.BLACK})}}}(e,{color:Cesium.Color.DEEPSKYBLUE,glow:.25});c.viewer.zoomTo(c.viewer.entities.add(t)),c.stopLoading()}),i.player){var u=function(e){return turf.featurecollection([turf.simplify(e.features[0],.001,!1)])}(e);c.build3DLine(u,function(e){(r=new KR.PathTracer(c.viewer,e,u)).setPitchCorr(.1),a=new function(e){function t(){a.find(".glyphicon").removeClass("glyphicon-play").addClass("glyphicon-pause"),e.start()}function r(){a.find(".glyphicon").removeClass("glyphicon-pause").addClass("glyphicon-play"),e.stop()}var a=$("#playpause");return{play:t,pause:r,toggle:function(){e.isRunning()?r():t()}}}(r),$("#playpause").removeClass("hidden"),$("#playpause").click(a.toggle)}),p.addCloseCb(function(){l&&a.play()})}})}i=i||{},i=_.extend({player:!0,limitBounds:!1},i);var c,d,p=KR.CesiumSidebar($("#cesium-sidebar"),{});i.bbox?l(i.bbox):i.komm?e.getMunicipalityBounds(i.komm,l):i.line?u():alert("Missing parameters!")}}();
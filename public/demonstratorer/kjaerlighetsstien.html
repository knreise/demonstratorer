<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <title>KNReise - demonstratorer</title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    </head>

    <body>


        <div id='sidebar'></div>
        <div id='map'></div>

        <script type="text/template" id="description_template">
            <p class="small">Foto: Sindre Fl&oslash; (Lisens: CC BY-SA 3.0 NO)</p>
<p>Kj&aelig;rlighetsstien g&aring;r i et naturskj&oslash;nt omr&aring;de langs bredden av Gvarvelva og gjennom Gamlegate i Gvarv sentrum som med sine gamle fine trehus er i en severdighet i seg selv. </p>
        </script>

        <script src="../knreiseApi.js" type="text/javascript"></script>
        <script type='text/javascript' src='../../dist/setupMap.bundle.js'></script>
        <script type='text/javascript'>

            var title = 'Kjærlighetsstien og Gamlegata';
            var image = 'http://media31.dimu.no/media/image/H-DF/DF.4920/12312?width=600&height=380';

            (function () {
    'use strict';

    var api = new KR.API();

    var kulturminneFunctions = KR.Config.getKulturminneFunctions(api);
    var datasets = [
        {
            name: 'Digitalt fortalt',
            dataset: {dataset: 'difo', api: 'norvegiana'},
            cluster: true,
            template: KR.Util.getDatasetTemplate('digitalt_fortalt'),
            noListThreshold: Infinity
        },
        {
            name: 'Riksantikvaren',
            provider: 'Riksantikvaren',
            dataset: {
                api: 'kulturminnedataSparql',
                kommune: '0822'
            },
            template: KR.Util.getDatasetTemplate('ra_sparql'),
            bbox: false,
            isStatic: true,
            unclusterCount: 20,
            getFeatureData: kulturminneFunctions.getRaFeatureData,
            init: kulturminneFunctions.initKulturminnePoly,
        }
    ];


    var loveTrail = {
        api: 'cartodb',
        query: 'SELECT ST_AsGeoJSON(the_geom) as geom FROM kjaerlighetsstien_line'
    }

    function getLine (callback) {
        api.getData(loveTrail, function (geoJson)  {
            callback(geoJson);
        });
    }

    var options = {
        line: getLine,
        title: title,
        image: image,
        layer: 'topo2graatone',
        linecolor: '#292778',
        description: $('#description_template').html()
    };


    KR.setupMap(api, datasets, options, false);
}());

        </script>
    </body>
</html>
